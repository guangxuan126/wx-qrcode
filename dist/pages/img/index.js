'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var QR = require('../../utils/qrcode.js');
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    img: "",
    $loading: {
      isShow: false
    },
    $toast: {
      show: false
    }
  },
  gen: function gen() {
    var _this = this;

    this.setData({
      $loading: {
        isShow: true
      }
    });
    setTimeout(function () {
      _this.setData({
        $loading: {
          isShow: false
        },
        canvasHidden: false,
        isDisabled: false,
        isDisabled1: true
      });
    }, 2000);
    var that = this;
    var gendetail = getApp().globalData.gendetail;
    that.setData({
      canvasHidden: true
    });
    var st = setTimeout(function () {
      wx.hideToast();
      var size = that.setCanvasSize();
      that.createQrCode(gendetail, "mycanvas", size.w, size.h);
      clearTimeout(st);
    }, 1000);
  },

  onLoad: function onLoad(e) {
    var that = this;
    var gendetail = getApp().globalData.gendetail;
    console.log(gendetail);
    this.setData({
      gendetail: gendetail,
      isDisabled: true,
      isDisabled1: false
    });
    var size = this.setCanvasSize();
  },
  setCanvasSize: function setCanvasSize() {
    var size = {};
    try {
      var res = wx.getSystemInfoSync();
      var scale = 750 / 686;
      var width = res.windowWidth / scale;
      var height = width;
      size.w = width;
      size.h = height;
    } catch (e) {
      console.log("获取设备信息失败" + e);
    }
    return size;
  },
  createQrCode: function createQrCode(gendetail, canvasId, cavW, cavH) {
    var _this2 = this;

    QR.api.draw(gendetail, canvasId, cavW, cavH);
    setTimeout(function () {
      _this2.canvasToTempImage();
    }, 1000);
  },
  canvasToTempImage: function canvasToTempImage() {
    var that = this;
    wx.canvasToTempFilePath({
      canvasId: 'mycanvas',
      success: function success(res) {
        var tempFilePath = res.tempFilePath;
        console.log(tempFilePath);
        that.setData({
          imagePath: tempFilePath
        });
      },
      fail: function fail(res) {
        console.log(res);
      }
    });
  },
  previewImg: function previewImg(e) {
    var img = this.data.imagePath;
    console.log(img);
    wx.previewImage({
      current: 'img',
      urls: [img]
    });
  },
  save: function save(e) {
    wx.canvasToTempFilePath({
      canvasId: 'mycanvas',
      success: function success(res) {
        var tempFilePath = res.tempFilePath;
        wx.saveImageToPhotosAlbum({
          filePath: res.tempFilePath,
          success: function success(data) {
            console.log(data);
            wx.showToast({
              title: '保存成功',
              icon: 'success',
              duration: 2000
            });
          },
          fail: function fail(err) {
            console.log(err);
            wx.showToast({
              title: '保存失败，请删除小程序后重新获得权限',
              icon: 'none',
              duration: 2000
            });
          }
        });
      },
      fail: function fail(res) {
        console.log(res);
      }
    });
  },
  onShareAppMessage: function onShareAppMessage() {
    return {
      title: 'QR二维码',
      path: '/pages/home/index',
      imageUrl: 'https://images.gxuann.cn/qrcode/share.png'
    };
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJRUiIsInJlcXVpcmUiLCJkYXRhIiwiaW1nIiwiJGxvYWRpbmciLCJpc1Nob3ciLCIkdG9hc3QiLCJzaG93IiwiZ2VuIiwic2V0RGF0YSIsInNldFRpbWVvdXQiLCJjYW52YXNIaWRkZW4iLCJpc0Rpc2FibGVkIiwiaXNEaXNhYmxlZDEiLCJ0aGF0IiwiZ2VuZGV0YWlsIiwiZ2V0QXBwIiwiZ2xvYmFsRGF0YSIsInN0Iiwid3giLCJoaWRlVG9hc3QiLCJzaXplIiwic2V0Q2FudmFzU2l6ZSIsImNyZWF0ZVFyQ29kZSIsInciLCJoIiwiY2xlYXJUaW1lb3V0Iiwib25Mb2FkIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJyZXMiLCJnZXRTeXN0ZW1JbmZvU3luYyIsInNjYWxlIiwid2lkdGgiLCJ3aW5kb3dXaWR0aCIsImhlaWdodCIsImNhbnZhc0lkIiwiY2F2VyIsImNhdkgiLCJhcGkiLCJkcmF3IiwiY2FudmFzVG9UZW1wSW1hZ2UiLCJjYW52YXNUb1RlbXBGaWxlUGF0aCIsInN1Y2Nlc3MiLCJ0ZW1wRmlsZVBhdGgiLCJpbWFnZVBhdGgiLCJmYWlsIiwicHJldmlld0ltZyIsInByZXZpZXdJbWFnZSIsImN1cnJlbnQiLCJ1cmxzIiwic2F2ZSIsInNhdmVJbWFnZVRvUGhvdG9zQWxidW0iLCJmaWxlUGF0aCIsInNob3dUb2FzdCIsInRpdGxlIiwiaWNvbiIsImR1cmF0aW9uIiwiZXJyIiwib25TaGFyZUFwcE1lc3NhZ2UiLCJwYXRoIiwiaW1hZ2VVcmwiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBSUEsS0FBS0MsUUFBUSx1QkFBUixDQUFUOztBQVNFQyxRQUFNO0FBQUE7QUFBQTtBQUFBOztBQUNKQyxTQUFJLEVBREE7QUFFSkMsY0FBVTtBQUNOQyxjQUFRO0FBREYsS0FGTjtBQUtKQyxZQUFRO0FBQ05DLFlBQU07QUFEQTtBQUxKLEc7QUFTTkMsSyxpQkFBTTtBQUFBOztBQUNKLFNBQUtDLE9BQUwsQ0FBYTtBQUNY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QUFULEVBQVc7QUFDZlQsT0FBR3dCLG9CQUFILENBQXdCO0FBQ3RCTixnQkFBVSxVQURZO0FBRXRCTyxlQUFTLGlCQUFVYixHQUFWLEVBQWU7QUFDdEIsWUFBSWMsZUFBZWQsSUFBSWMsWUFBdkI7QUFDQTFCLFdBQUdrQyxzQkFBSCxDQUEwQjtBQUN4QkMsb0JBQVV2QixJQUFJYyxZQURVO0FBRXhCRCxtQkFBUyxpQkFBVTFDLElBQVYsRUFBZ0I7QUFDdkIyQixvQkFBUUMsR0FBUixDQUFZNUIsSUFBWjtBQUNBaUIsZUFBR29DLFNBQUgsQ0FBYTtBQUNYQyxxQkFBTyxNQURJO0FBRVhDLG9CQUFNLFNBRks7QUFHWEMsd0JBQVU7QUFIQyxhQUFiO0FBS0QsV0FUdUI7QUFVeEJYLGdCQUFNLGNBQVVZLEdBQVYsRUFBZTtBQUNuQjlCLG9CQUFRQyxHQUFSLENBQVk2QixHQUFaO0FBQ0F4QyxlQUFHb0MsU0FBSCxDQUFhO0FBQ1hDLHFCQUFPLG9CQURJO0FBRVhDLG9CQUFNLE1BRks7QUFHWEMsd0JBQVU7QUFIQyxhQUFiO0FBS0Q7QUFqQnVCLFNBQTFCO0FBbUJELE9BdkJxQjtBQXdCdEJYLFlBQU0sY0FBVWhCLEdBQVYsRUFBZTtBQUNuQkYsZ0JBQVFDLEdBQVIsQ0FBWUMsR0FBWjtBQUNEO0FBMUJxQixLQUF4QjtBQTRCRCxHO0FBQ0Q2QixxQkFBbUIsNkJBQVk7QUFDN0IsV0FBTztBQUNMSixhQUFPLE9BREY7QUFFTEssWUFBTSxtQkFGRDtBQUdMQyxnQkFBVTtBQUhMLEtBQVA7QUFLRCIsImZpbGUiOiJpbmRleC53eHAiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgUVIgPSByZXF1aXJlKCcuLi8uLi91dGlscy9xcmNvZGUuanMnKVxuZXhwb3J0IGRlZmF1bHQge1xuICBjb25maWc6IHtcbiAgICBuYXZpZ2F0aW9uQmFyVGl0bGVUZXh0OiAnUVLkuoznu7TnoIEnLFxuICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgJ3d4Yy1sb2FkaW5nJzogJ0BtaW51aS93eGMtbG9hZGluZycsXG4gICAgICAnd3hjLXRvYXN0JzogJ0BtaW51aS93eGMtdG9hc3QnXG4gICAgfVxuICB9LFxuICBkYXRhOiB7XG4gICAgaW1nOlwiXCIsXG4gICAgJGxvYWRpbmc6IHtcbiAgICAgICAgaXNTaG93OiBmYWxzZVxuICAgIH0sXG4gICAgJHRvYXN0OiB7XG4gICAgICBzaG93OiBmYWxzZVxuICAgIH1cbiAgfSxcbiAgZ2VuKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAkbG9hZGluZzoge1xuICAgICAgICBpc1Nob3c6IHRydWVcbiAgICAgIH1cbiAgICB9KVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJGxvYWRpbmc6IHtcbiAgICAgICAgICBpc1Nob3c6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGNhbnZhc0hpZGRlbjpmYWxzZSxcbiAgICAgICAgaXNEaXNhYmxlZDpmYWxzZSxcbiAgICAgICAgaXNEaXNhYmxlZDE6dHJ1ZSxcbiAgICAgIH0pXG4gICAgfSwgMjAwMClcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgdmFyIGdlbmRldGFpbCA9IGdldEFwcCgpLmdsb2JhbERhdGEuZ2VuZGV0YWlsO1xuICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICBjYW52YXNIaWRkZW46dHJ1ZSxcbiAgICB9KTtcbiAgICB2YXIgc3QgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICB3eC5oaWRlVG9hc3QoKVxuICAgICAgdmFyIHNpemUgPSB0aGF0LnNldENhbnZhc1NpemUoKTtcbiAgICAgIHRoYXQuY3JlYXRlUXJDb2RlKGdlbmRldGFpbCxcIm15Y2FudmFzXCIsc2l6ZS53LHNpemUuaCk7XG4gICAgICBjbGVhclRpbWVvdXQoc3QpO1xuICAgIH0sMTAwMCk7XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24oZSl7XG4gICAgdmFyIHRoYXQgPSB0aGlzXG4gICAgdmFyIGdlbmRldGFpbCA9IGdldEFwcCgpLmdsb2JhbERhdGEuZ2VuZGV0YWlsXG4gICAgY29uc29sZS5sb2coZ2VuZGV0YWlsKTtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgZ2VuZGV0YWlsOiBnZW5kZXRhaWwsXG4gICAgICBpc0Rpc2FibGVkOiB0cnVlLFxuICAgICAgaXNEaXNhYmxlZDE6ZmFsc2UsXG4gICAgfSk7XG4gICAgdmFyIHNpemUgPSB0aGlzLnNldENhbnZhc1NpemUoKTtcbiAgfSxcbiAgc2V0Q2FudmFzU2l6ZTpmdW5jdGlvbigpe1xuICAgIHZhciBzaXplPXt9O1xuICAgIHRyeSB7XG4gICAgICAgIHZhciByZXMgPSB3eC5nZXRTeXN0ZW1JbmZvU3luYygpO1xuICAgICAgICB2YXIgc2NhbGUgPSA3NTAvNjg2O1xuICAgICAgICB2YXIgd2lkdGggPSByZXMud2luZG93V2lkdGgvc2NhbGU7XG4gICAgICAgIHZhciBoZWlnaHQgPSB3aWR0aDtcbiAgICAgICAgc2l6ZS53ID0gd2lkdGg7XG4gICAgICAgIHNpemUuaCA9IGhlaWdodDtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLojrflj5borr7lpIfkv6Hmga/lpLHotKVcIitlKTtcbiAgICAgIH1cbiAgICByZXR1cm4gc2l6ZTtcbiAgfSAsXG4gIGNyZWF0ZVFyQ29kZTpmdW5jdGlvbihnZW5kZXRhaWwsY2FudmFzSWQsY2F2VyxjYXZIKXtcbiAgICBRUi5hcGkuZHJhdyhnZW5kZXRhaWwsY2FudmFzSWQsY2F2VyxjYXZIKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5jYW52YXNUb1RlbXBJbWFnZSgpO30sMTAwMCk7XG4gIH0sXG4gIGNhbnZhc1RvVGVtcEltYWdlOmZ1bmN0aW9uKCl7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgIHd4LmNhbnZhc1RvVGVtcEZpbGVQYXRoKHtcbiAgICAgIGNhbnZhc0lkOiAnbXljYW52YXMnLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgIHZhciB0ZW1wRmlsZVBhdGggPSByZXMudGVtcEZpbGVQYXRoO1xuICAgICAgICAgIGNvbnNvbGUubG9nKHRlbXBGaWxlUGF0aCk7XG4gICAgICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgICAgICAgaW1hZ2VQYXRoOnRlbXBGaWxlUGF0aCxcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBmYWlsOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgcHJldmlld0ltZzpmdW5jdGlvbihlKXtcbiAgICB2YXIgaW1nID0gdGhpcy5kYXRhLmltYWdlUGF0aDtcbiAgICBjb25zb2xlLmxvZyhpbWcpO1xuICAgIHd4LnByZXZpZXdJbWFnZSh7XG4gICAgICBjdXJyZW50OiAnaW1nJyxcbiAgICAgIHVybHM6IFtpbWddXG4gICAgfSlcbiAgfSxcbiAgc2F2ZTogZnVuY3Rpb24oZSl7XG4gICAgd3guY2FudmFzVG9UZW1wRmlsZVBhdGgoe1xuICAgICAgY2FudmFzSWQ6ICdteWNhbnZhcycsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIHZhciB0ZW1wRmlsZVBhdGggPSByZXMudGVtcEZpbGVQYXRoXG4gICAgICAgIHd4LnNhdmVJbWFnZVRvUGhvdG9zQWxidW0oe1xuICAgICAgICAgIGZpbGVQYXRoOiByZXMudGVtcEZpbGVQYXRoLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjmiJDlip8nLFxuICAgICAgICAgICAgICBpY29uOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgdGl0bGU6ICfkv53lrZjlpLHotKXvvIzor7fliKDpmaTlsI/nqIvluo/lkI7ph43mlrDojrflvpfmnYPpmZAnLFxuICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBmYWlsOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogJ1FS5LqM57u056CBJyxcbiAgICAgIHBhdGg6ICcvcGFnZXMvaG9tZS9pbmRleCcsXG4gICAgICBpbWFnZVVybDogJ2h0dHBzOi8vaW1hZ2VzLmd4dWFubi5jbi9xcmNvZGUvc2hhcmUucG5nJ1xuICAgIH1cbiAgfVxufSJdfQ==